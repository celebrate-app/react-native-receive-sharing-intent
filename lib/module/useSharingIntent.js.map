{"version":3,"sources":["useSharingIntent.ts"],"names":["useCallback","useEffect","AppState","Linking","NativeModules","Platform","sortData","ReceiveSharingIntent","isIos","OS","useSharingIntent","handler","errorHandler","protocol","getFileNames","url","then","data","files","catch","e","fileObject","Object","keys","map","k","getInitialURL","res","startsWith","listener","addEventListener","remove","status"],"mappings":"AAAA,SAASA,WAAT,EAAsBC,SAAtB,QAAuC,OAAvC;AACA,SAASC,QAAT,EAAmBC,OAAnB,EAA4BC,aAA5B,EAA2CC,QAA3C,QAA2D,cAA3D;AAEA,SAASC,QAAT,QAAyB,SAAzB;AACA,MAAM;AAAEC,EAAAA;AAAF,IAA2BH,aAAjC;AAEA,MAAMI,KAAK,GAAGH,QAAQ,CAACI,EAAT,KAAgB,KAA9B;AAEA,OAAO,SAASC,gBAAT,CACLC,OADK,EAELC,YAFK,EAGLC,QAAgB,GAAG,YAHd,EAIL;AACA,QAAMC,YAAY,GAAGd,WAAW,CAC7Be,GAAD,IAAiB;AACf,QAAIP,KAAJ,EAAW;AACTD,MAAAA,oBAAoB,CAACO,YAArB,CAAkCC,GAAlC,EACGC,IADH,CACSC,IAAD,IAAe;AACnB,cAAMC,KAAK,GAAGZ,QAAQ,CAACW,IAAD,CAAtB;AACAN,QAAAA,OAAO,CAACO,KAAD,CAAP;AACD,OAJH,EAKGC,KALH,CAKUC,CAAD,IAAYR,YAAY,CAACQ,CAAD,CALjC;AAMD,KAPD,MAOO;AACLb,MAAAA,oBAAoB,CAACO,YAArB,GACGE,IADH,CACSK,UAAD,IAAqB;AACzB,cAAMH,KAAK,GAAGI,MAAM,CAACC,IAAP,CAAYF,UAAZ,EAAwBG,GAAxB,CAA6BC,CAAD,IAAOJ,UAAU,CAACI,CAAD,CAA7C,CAAd;AACAd,QAAAA,OAAO,CAACO,KAAD,CAAP;AACD,OAJH,EAKGC,KALH,CAKUC,CAAD,IAAYR,YAAY,CAACQ,CAAD,CALjC;AAMD;AACF,GAjB6B,EAkB9B,CAACT,OAAD,EAAUC,YAAV,CAlB8B,CAAhC;AAqBAX,EAAAA,SAAS,CAAC,MAAM;AACd,QAAIO,KAAJ,EAAW;AACTL,MAAAA,OAAO,CAACuB,aAAR,GACGV,IADH,CACSW,GAAD,IAAc;AAClB,YAAIA,GAAJ,aAAIA,GAAJ,eAAIA,GAAG,CAAEC,UAAL,CAAiB,GAAEf,QAAS,YAA5B,CAAJ,EAA8C;AAC5CC,UAAAA,YAAY,CAACa,GAAD,CAAZ;AACD;AACF,OALH,EAMGR,KANH,CAMS,MAAM,CAAE,CANjB;AAQA,YAAMU,QAAa,GAAG1B,OAAO,CAAC2B,gBAAR,CAAyB,KAAzB,EAAiCH,GAAD,IAAc;AAClE,cAAMZ,GAAG,GAAGY,GAAG,GAAGA,GAAG,CAACZ,GAAP,GAAa,EAA5B;;AACA,YAAIA,GAAG,CAACa,UAAJ,CAAgB,GAAEf,QAAS,YAA3B,CAAJ,EAA6C;AAC3CC,UAAAA,YAAY,CAACa,GAAG,CAACZ,GAAL,CAAZ;AACD;AACF,OALqB,CAAtB;AAOA,aAAO,MAAM;AACXc,QAAAA,QAAQ,SAAR,IAAAA,QAAQ,WAAR,YAAAA,QAAQ,CAAEE,MAAV;AACD,OAFD;AAGD,KAnBD,MAmBO;AACL,YAAMF,QAAa,GAAG3B,QAAQ,CAAC4B,gBAAT,CACpB,QADoB,EAEnBE,MAAD,IAAoB;AAClB,YAAIA,MAAM,KAAK,QAAf,EAAyB;AACvBlB,UAAAA,YAAY,CAAC,EAAD,CAAZ;AACD;AACF,OANmB,CAAtB;AASA,aAAO,MAAM;AACXe,QAAAA,QAAQ,SAAR,IAAAA,QAAQ,WAAR,YAAAA,QAAQ,CAAEE,MAAV;AACD,OAFD;AAGD;AACF,GAlCQ,EAkCN,CAACjB,YAAD,EAAeD,QAAf,CAlCM,CAAT;AAmCD","sourcesContent":["import { useCallback, useEffect } from 'react';\nimport { AppState, Linking, NativeModules, Platform } from 'react-native';\n\nimport { sortData } from './utils';\nconst { ReceiveSharingIntent } = NativeModules;\n\nconst isIos = Platform.OS === 'ios';\n\nexport function useSharingIntent(\n  handler: Function,\n  errorHandler: Function,\n  protocol: string = 'ShareMedia'\n) {\n  const getFileNames = useCallback(\n    (url: string) => {\n      if (isIos) {\n        ReceiveSharingIntent.getFileNames(url)\n          .then((data: any) => {\n            const files = sortData(data);\n            handler(files);\n          })\n          .catch((e: any) => errorHandler(e));\n      } else {\n        ReceiveSharingIntent.getFileNames()\n          .then((fileObject: any) => {\n            const files = Object.keys(fileObject).map((k) => fileObject[k]);\n            handler(files);\n          })\n          .catch((e: any) => errorHandler(e));\n      }\n    },\n    [handler, errorHandler]\n  );\n\n  useEffect(() => {\n    if (isIos) {\n      Linking.getInitialURL()\n        .then((res: any) => {\n          if (res?.startsWith(`${protocol}://dataUrl`)) {\n            getFileNames(res);\n          }\n        })\n        .catch(() => {});\n\n      const listener: any = Linking.addEventListener('url', (res: any) => {\n        const url = res ? res.url : '';\n        if (url.startsWith(`${protocol}://dataUrl`)) {\n          getFileNames(res.url);\n        }\n      });\n\n      return () => {\n        listener?.remove();\n      };\n    } else {\n      const listener: any = AppState.addEventListener(\n        'change',\n        (status: string) => {\n          if (status === 'active') {\n            getFileNames('');\n          }\n        }\n      );\n\n      return () => {\n        listener?.remove();\n      };\n    }\n  }, [getFileNames, protocol]);\n}\n"]}